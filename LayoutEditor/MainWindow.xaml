<Window x:Class="LayoutEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:LayoutEditor.Controls"
        Title="Simulation Layout Editor" Height="800" Width="1400"
        WindowStartupLocation="CenterScreen" WindowState="Maximized"
        KeyDown="Window_KeyDown" Closing="Window_Closing">
    
    <Window.Resources>
        <SolidColorBrush x:Key="PanelBg" Color="#F5F5F5"/>
        <SolidColorBrush x:Key="HeaderBg" Color="#E8E8E8"/>
        <SolidColorBrush x:Key="Border" Color="#CCCEDB"/>
        <SolidColorBrush x:Key="Accent" Color="#007ACC"/>
        <SolidColorBrush x:Key="TextMuted" Color="#6E6E6E"/>
        
        <Style x:Key="Btn" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <Style x:Key="ToolBtn" TargetType="RadioButton">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="bd" Background="Transparent" BorderThickness="1" CornerRadius="2" ToolTip="{TemplateBinding ToolTip}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True"><Setter TargetName="bd" Property="Background" Value="#E5E5E5"/></Trigger>
                            <Trigger Property="IsChecked" Value="True"><Setter TargetName="bd" Property="Background" Value="#CCE8FF"/><Setter TargetName="bd" Property="BorderBrush" Value="{StaticResource Accent}"/></Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="NodeBtn" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <Style x:Key="SmallNodeBtn" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="2"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E8F4FD"/>
                    <Setter Property="BorderBrush" Value="#007ACC"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="LayerCheckBox" TargetType="CheckBox">
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="FontSize" Value="10"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Menu -->
        <Menu Grid.Row="0" Background="White" BorderBrush="#DEE2E6" BorderThickness="0,0,0,1">
            <MenuItem Header="_File">
                <MenuItem Header="_New" Click="New_Click" InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Open..." Click="Open_Click" InputGestureText="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Save" Click="Save_Click" InputGestureText="Ctrl+S"/>
                <MenuItem Header="Save _As..." Click="SaveAs_Click"/>
                <Separator/>
                <MenuItem Header="_Import">
                    <MenuItem Header="Background Image..." Click="ImportBackground_Click"/>
                    <MenuItem Header="DXF..." Click="ImportDxf_Click"/>
                    <MenuItem Header="Clear Background" Click="ClearBackground_Click"/>
                </MenuItem>
                <MenuItem Header="_Export">
                    <MenuItem Header="Simulation JSON..." Click="ExportSimulation_Click"/>
                    <MenuItem Header="Image (PNG)..." Click="ExportImage_Click"/>
                    <MenuItem Header="SVG..." Click="ExportSvg_Click"/>
                    <MenuItem Header="DXF..." Click="ExportDxf_Click"/>
                    <MenuItem Header="BOM CSV..." Click="ExportBomCsv_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" Click="Undo_Click" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="_Redo" Click="Redo_Click" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="Cu_t" Click="Cut_Click" InputGestureText="Ctrl+X"/>
                <MenuItem Header="_Copy" Click="Copy_Click" InputGestureText="Ctrl+C"/>
                <MenuItem Header="_Paste" Click="Paste_Click" InputGestureText="Ctrl+V"/>
                <MenuItem Header="_Duplicate" Click="Duplicate_Click" InputGestureText="Ctrl+D"/>
                <MenuItem Header="Delete" Click="Delete_Click" InputGestureText="Del"/>
                <Separator/>
                <MenuItem Header="Select All" Click="SelectAll_Click" InputGestureText="Ctrl+A"/>
                <MenuItem Header="Group" Click="Group_Click" InputGestureText="Ctrl+G"/>
                <MenuItem Header="Ungroup" Click="Ungroup_Click" InputGestureText="Ctrl+Shift+G"/>
                <MenuItem Header="Define as Cell" Click="DefineCell_Click" InputGestureText="Ctrl+Shift+C"/>
                <MenuItem Header="Ungroup Cell" Click="UngroupCell_Click"/>
                <MenuItem Header="Refresh Cell Entry/Exit" Click="RefreshCellEntryExit_Click"/>
                <Separator/>
                <MenuItem Header="Align">
                    <MenuItem Header="Left" Click="AlignLeft_Click"/>
                    <MenuItem Header="Right" Click="AlignRight_Click"/>
                    <MenuItem Header="Top" Click="AlignTop_Click"/>
                    <MenuItem Header="Bottom" Click="AlignBottom_Click"/>
                    <Separator/>
                    <MenuItem Header="Center H" Click="AlignCenterH_Click"/>
                    <MenuItem Header="Center V" Click="AlignCenterV_Click"/>
                    <Separator/>
                    <MenuItem Header="Distribute H" Click="DistributeH_Click"/>
                    <MenuItem Header="Distribute V" Click="DistributeV_Click"/>
                    <Separator/>
                    <MenuItem Header="Same Width" Click="SameWidth_Click"/>
                    <MenuItem Header="Same Height" Click="SameHeight_Click"/>
                    <MenuItem Header="Same Size" Click="SameSize_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Editor Settings..." Click="EditorSettings_Click"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Zoom In" Click="ZoomIn_Click" InputGestureText="Ctrl++"/>
                <MenuItem Header="Zoom Out" Click="ZoomOut_Click" InputGestureText="Ctrl+-"/>
                <MenuItem Header="Zoom to Fit" Click="ZoomFit_Click" InputGestureText="Ctrl+0"/>
                <MenuItem Header="Reset Zoom" Click="ZoomReset_Click"/>
                <Separator/>
                <MenuItem Header="Show Grid" x:Name="ShowGridMenu" IsCheckable="True" IsChecked="True" Click="ToggleGrid_Click"/>
                <MenuItem Header="Show Rulers" x:Name="ShowRulersMenu" IsCheckable="True" IsChecked="True" Click="ToggleRulers_Click"/>
                <MenuItem Header="Show Minimap" x:Name="ShowMinimapMenu" IsCheckable="True" IsChecked="False" Click="ToggleMinimap_Click"/>
                <MenuItem Header="Show Labels" x:Name="ShowLabelsMenu" IsCheckable="True" IsChecked="True" Click="ToggleLabels_Click"/>
                <Separator/>
                <MenuItem Header="Snap to Grid" x:Name="SnapToGridMenu" IsCheckable="True" IsChecked="True"/>
                <MenuItem Header="Show Guides" x:Name="ShowGuidesMenu" IsCheckable="True" IsChecked="True"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="Apply Canonical Names" Click="ApplyCanonicalNames_Click"/>
                <MenuItem Header="Rename Nodes Only" Click="ApplyCanonicalNamesNodes_Click"/>
                <MenuItem Header="Rename Cells Only" Click="ApplyCanonicalNamesCells_Click"/>
                <MenuItem Header="Reset Names" Click="ResetNames_Click"/>
                <Separator/>
                <MenuItem Header="Auto-Generate Paths" Click="AutoGeneratePaths_Click"/>
                <MenuItem Header="Clear All Paths" Click="ClearPaths_Click"/>
                <Separator/>
                <MenuItem Header="Resource Pools..." Click="ResourcePools_Click"/>
                <MenuItem Header="Templates Manager..." Click="TemplatesManager_Click"/>
                <MenuItem Header="Layout Properties..." Click="LayoutProperties_Click"/>
            </MenuItem>
            <MenuItem Header="_Validate">
                <MenuItem Header="Validate Layout" Click="Validate_Click" InputGestureText="F5"/>
                <MenuItem Header="Show Validation Panel" x:Name="ShowValidationMenu" IsCheckable="True" Click="ToggleValidation_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="Keyboard Shortcuts" Click="Shortcuts_Click"/>
                <MenuItem Header="User Guide" Click="UserGuide_Click"/>
                <Separator/>
                <MenuItem Header="About" Click="About_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Toolbar -->
        <Border Grid.Row="1" Background="White" BorderBrush="#DEE2E6" BorderThickness="0,0,0,1" Padding="4,2">
            <StackPanel Orientation="Horizontal">
                <Button Style="{StaticResource Btn}" ToolTip="New" Click="New_Click"><TextBlock Text="ðŸ“„" FontSize="14"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Open" Click="Open_Click"><TextBlock Text="ðŸ“‚" FontSize="14"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Save" Click="Save_Click"><TextBlock Text="ðŸ’¾" FontSize="14"/></Button>
                <Separator Margin="4,4"/>
                <Button Style="{StaticResource Btn}" ToolTip="Undo" Click="Undo_Click"><TextBlock Text="â†©" FontSize="14"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Redo" Click="Redo_Click"><TextBlock Text="â†ª" FontSize="14"/></Button>
                <Separator Margin="4,4"/>
                <RadioButton x:Name="SelectTool" Style="{StaticResource ToolBtn}" IsChecked="True" ToolTip="Select (V)" GroupName="Tools" Click="ToolButton_Click" Tag="select"><TextBlock Text="â¬š" FontSize="14"/></RadioButton>
                <RadioButton x:Name="AreaSelectTool" Style="{StaticResource ToolBtn}" ToolTip="Area Select (A) - drag rectangle to select multiple" GroupName="Tools" Click="ToolButton_Click" Tag="area"><TextBlock Text="â¬’" FontSize="14"/></RadioButton>
                <RadioButton x:Name="MoveTool" Style="{StaticResource ToolBtn}" ToolTip="Move (M)" GroupName="Tools" Click="ToolButton_Click" Tag="move"><TextBlock Text="âœ¥" FontSize="14"/></RadioButton>
                <RadioButton x:Name="PanTool" Style="{StaticResource ToolBtn}" ToolTip="Pan (H)" GroupName="Tools" Click="ToolButton_Click" Tag="pan"><TextBlock Text="âœ‹" FontSize="12"/></RadioButton>
                <RadioButton x:Name="PathTool" Style="{StaticResource ToolBtn}" ToolTip="Path (P)" GroupName="Tools" Click="ToolButton_Click" Tag="path"><TextBlock Text="â†—" FontSize="14"/></RadioButton>
                <RadioButton x:Name="WallTool" Style="{StaticResource ToolBtn}" ToolTip="Wall (W)" GroupName="Tools" Click="ToolButton_Click" Tag="wall"><TextBlock Text="â–­" FontSize="14"/></RadioButton>
                <RadioButton x:Name="CorridorTool" Style="{StaticResource ToolBtn}" ToolTip="Corridor (C)" GroupName="Tools" Click="ToolButton_Click" Tag="corridor"><TextBlock Text="â•" FontSize="14"/></RadioButton>
                <RadioButton x:Name="ZoneTool" Style="{StaticResource ToolBtn}" ToolTip="Zone (Z)" GroupName="Tools" Click="ToolButton_Click" Tag="zone"><TextBlock Text="â–¢" FontSize="14"/></RadioButton>
                <RadioButton x:Name="MeasureTool" Style="{StaticResource ToolBtn}" ToolTip="Measure (R)" GroupName="Tools" Click="ToolButton_Click" Tag="measure"><TextBlock Text="ðŸ“" FontSize="12"/></RadioButton>
                <RadioButton x:Name="ColumnTool" Style="{StaticResource ToolBtn}" ToolTip="Column" GroupName="Tools" Click="ToolButton_Click" Tag="column"><TextBlock Text="â¬¤" FontSize="12"/></RadioButton>
                <Separator Margin="4,4"/>
                <!-- Alignment Tools -->
                <Button Style="{StaticResource Btn}" ToolTip="Align Left" Click="AlignLeft_Click"><TextBlock Text="â«·" FontSize="12"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Align Center H" Click="AlignCenterH_Click"><TextBlock Text="â«¿" FontSize="12"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Align Right" Click="AlignRight_Click"><TextBlock Text="â«¸" FontSize="12"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Align Top" Click="AlignTop_Click"><TextBlock Text="âŠ¤" FontSize="12"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Align Center V" Click="AlignCenterV_Click"><TextBlock Text="âŠ" FontSize="12"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Align Bottom" Click="AlignBottom_Click"><TextBlock Text="âŠ¥" FontSize="12"/></Button>
                <Separator Margin="4,4"/>
                <CheckBox x:Name="PathEditMode" Content="Edit Paths" VerticalAlignment="Center" FontSize="10" Margin="4,0" Checked="PathEditMode_Changed" Unchecked="PathEditMode_Changed"/>
                <Separator Margin="4,4"/>
                <Button Style="{StaticResource Btn}" ToolTip="Zoom In" Click="ZoomIn_Click"><TextBlock Text="ðŸ”+" FontSize="10"/></Button>
                <Button Style="{StaticResource Btn}" ToolTip="Zoom Out" Click="ZoomOut_Click"><TextBlock Text="ðŸ”-" FontSize="10"/></Button>
                <TextBlock x:Name="ZoomLabel" Text="100%" VerticalAlignment="Center" Margin="4,0" FontSize="10"/>
                <Separator Margin="4,4"/>
                <TextBlock x:Name="ModeText" Text="" VerticalAlignment="Center" FontSize="10" Foreground="{StaticResource Accent}" FontWeight="SemiBold"/>
                <Separator Margin="4,4"/>
                <Button Style="{StaticResource Btn}" ToolTip="Validate" Click="Validate_Click"><TextBlock Text="âœ“" FontSize="14" Foreground="Green"/></Button>
                <TextBlock x:Name="ValidationStatus" Text="" VerticalAlignment="Center" FontSize="10" Margin="4,0"/>
            </StackPanel>
        </Border>
        
        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" MinWidth="150" MaxWidth="350"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="220" MinWidth="180" MaxWidth="400"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left Panel -->
            <Border Grid.Column="0" Background="{StaticResource PanelBg}" BorderBrush="{StaticResource Border}" BorderThickness="0,0,0.5,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Floor Selector -->
                        <Border Background="{StaticResource HeaderBg}" Padding="4" BorderBrush="{StaticResource Border}" BorderThickness="0,0,0,1">
                            <StackPanel>
                                <TextBlock Text="Floor" FontWeight="SemiBold" FontSize="10" Margin="0,0,0,4"/>
                                <ComboBox x:Name="FloorCombo" Height="22" FontSize="10" SelectionChanged="Floor_Changed">
                                    <ComboBoxItem Content="All Floors" Tag="all" IsSelected="True"/>
                                    <ComboBoxItem Content="Ground" Tag="F1"/>
                                </ComboBox>
                                <Button Content="Manage Floors..." Click="ManageFloors_Click" Height="18" FontSize="8" Margin="0,4,0,0" HorizontalAlignment="Left" Padding="8,1"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Toolbox - Expanded -->
                        <Border Background="{StaticResource HeaderBg}" Padding="4">
                            <Expander Header="Toolbox" IsExpanded="True">
                                <StackPanel>
                                    <TextBlock Text="Click to place, or right-click canvas" FontSize="8" Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" Margin="0,0,0,4"/>
                                    
                                    <!-- Sources & Sinks -->
                                    <TextBlock Text="Flow" FontSize="8" Foreground="{StaticResource TextMuted}" Margin="0,2,0,2"/>
                                    <WrapPanel>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="source" Click="AddNode_Click" ToolTip="Source - Parts enter"><Path Data="M2,10 L12,10 M8,5 L14,10 L8,15" Stroke="#2ECC71" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="sink" Click="AddNode_Click" ToolTip="Sink - Parts exit"><Path Data="M4,3 L4,15 M4,3 L14,3 L14,9 L4,9" Stroke="#E74C3C" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="junction" Click="AddNode_Click" ToolTip="Junction - Split/Merge"><Path Data="M8,2 L8,14 M2,8 L14,8" Stroke="#1ABC9C" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="decision" Click="AddNode_Click" ToolTip="Decision - Routing"><Path Data="M8,2 L14,8 L8,14 L2,8 Z" Stroke="#9B59B6" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                    </WrapPanel>
                                    
                                    <!-- Processing -->
                                    <TextBlock Text="Processing" FontSize="8" Foreground="{StaticResource TextMuted}" Margin="0,4,0,2"/>
                                    <WrapPanel>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="machine" Click="AddNode_Click" ToolTip="Machine - Processing"><Path Data="M2,5 L14,5 L14,13 L2,13 Z M5,5 L5,2 L11,2 L11,5" Stroke="#4A90D9" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="workstation" Click="AddNode_Click" ToolTip="Workstation - Manual"><Path Data="M2,7 L14,7 L14,13 L2,13 Z M4,7 L4,4 L7,4 L7,7" Stroke="#7ED321" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="assembly" Click="AddNode_Click" ToolTip="Assembly - Combine"><Path Data="M2,4 L8,8 L2,12 M14,4 L8,8 L14,12" Stroke="#16A085" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="inspection" Click="AddNode_Click" ToolTip="Inspection - QC"><Path Data="M7,2 A4,4 0 1,0 7,10 M10,9 L14,13" Stroke="#9B59B6" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="robot" Click="AddNode_Click" ToolTip="Robot"><Path Data="M8,4 L8,10 M4,6 L12,6 M4,6 L2,10 M12,6 L14,10 M6,2 L10,2 L10,4 L6,4 Z" Stroke="#E67E22" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="printer3d" Click="AddNode_Click" ToolTip="3D Printer"><Path Data="M2,6 L14,6 L14,14 L2,14 Z M4,6 L4,2 L12,2 L12,6 M6,10 L10,10" Stroke="#3498DB" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                    </WrapPanel>
                                    
                                    <!-- Storage & Buffers -->
                                    <TextBlock Text="Storage" FontSize="8" Foreground="{StaticResource TextMuted}" Margin="0,4,0,2"/>
                                    <WrapPanel>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="buffer" Click="AddNode_Click" ToolTip="Buffer - Queue"><Path Data="M2,4 L14,4 L14,12 L2,12 Z M2,7 L14,7 M2,10 L14,10" Stroke="#F5A623" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="storage" Click="AddNode_Click" ToolTip="Storage - Warehouse"><Path Data="M2,2 L2,14 M14,2 L14,14 M2,2 L14,2 M2,8 L14,8 M8,2 L8,14" Stroke="#8E44AD" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="rack" Click="AddNode_Click" ToolTip="Rack - Shelving"><Path Data="M3,2 L3,14 M13,2 L13,14 M3,4 L13,4 M3,8 L13,8 M3,12 L13,12" Stroke="#8E44AD" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="pallet" Click="AddNode_Click" ToolTip="Pallet Position"><Path Data="M2,10 L14,10 L14,14 L2,14 Z M4,10 L4,6 L12,6 L12,10" Stroke="#95A5A6" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                    </WrapPanel>
                                    
                                    <!-- Transport -->
                                    <TextBlock Text="Transport" FontSize="8" Foreground="{StaticResource TextMuted}" Margin="0,4,0,2"/>
                                    <WrapPanel>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="conveyor" Click="AddNode_Click" ToolTip="Conveyor"><Path Data="M2,6 L14,6 M2,10 L14,10" Stroke="#95A5A6" StrokeThickness="1.5" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="agv_station" Click="AddNode_Click" ToolTip="AGV Station"><Path Data="M4,10 L12,10 M4,12 L12,12 M3,10 A2,2 0 0,1 3,6 L13,6 A2,2 0 0,1 13,10" Stroke="#3498DB" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="elevator" Click="AddNode_Click" ToolTip="Elevator - Floor connector"><Path Data="M4,2 L4,14 M12,2 L12,14 M4,2 L12,2 M4,14 L12,14 M6,6 L10,6 M8,4 L8,8 M6,10 L10,10 M8,12 L8,8" Stroke="#E74C3C" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="dock" Click="AddNode_Click" ToolTip="Loading Dock"><Path Data="M2,4 L2,12 L10,12 L10,4 M10,6 L14,6 L14,10 L10,10" Stroke="#27AE60" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                    </WrapPanel>
                                    
                                    <!-- People -->
                                    <TextBlock Text="People" FontSize="8" Foreground="{StaticResource TextMuted}" Margin="0,4,0,2"/>
                                    <WrapPanel>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="operator" Click="AddNode_Click" ToolTip="Operator"><Path Data="M8,4 A2,2 0 1,0 8,0 M8,6 L8,10 M4,8 L12,8 M8,10 L5,14 M8,10 L11,14" Stroke="#3498DB" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                        <Button Style="{StaticResource SmallNodeBtn}" Tag="crew" Click="AddNode_Click" ToolTip="Crew Station"><Path Data="M5,3 A1.5,1.5 0 1,0 5,0 M11,3 A1.5,1.5 0 1,0 11,0 M5,5 L5,9 M11,5 L11,9 M3,7 L7,7 M9,7 L13,7" Stroke="#3498DB" StrokeThickness="1.2" Width="14" Height="14" Stretch="Uniform"/></Button>
                                    </WrapPanel>
                                    
                                    <Button Content="More Nodes..." Click="ShowNodePalette_Click" Height="20" FontSize="9" Margin="0,6,0,0" HorizontalAlignment="Left" Padding="10,2"/>
                                </StackPanel>
                            </Expander>
                        </Border>
                        
                        <!-- Visibility Toggles -->
                        <Border Background="{StaticResource HeaderBg}" Padding="4" BorderBrush="{StaticResource Border}" BorderThickness="0,1,0,0">
                            <Expander Header="Visibility" IsExpanded="True">
                                <StackPanel>
                                    <WrapPanel>
                                        <CheckBox x:Name="LayerBackgroundImage" Content="Image" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerWalls" Content="Walls" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerNodes" Content="Nodes" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerPaths" Content="Paths" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerLabels" Content="Labels" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerZones" Content="Zones" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerBackground" Content="Grid" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerMeasurements" Content="Measurements" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed" Margin="0,0,8,2"/>
                                        <CheckBox x:Name="LayerCorridors" Content="Corridors" IsChecked="True" Style="{StaticResource LayerCheckBox}" Click="Layer_Changed"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>
                        </Border>
                        
                        <!-- Templates -->
                        <Border Background="{StaticResource HeaderBg}" Padding="4" BorderBrush="{StaticResource Border}" BorderThickness="0,1,0,0">
                            <Expander Header="Templates" IsExpanded="True">
                                <StackPanel>
                                    <ListBox x:Name="TemplateList" Height="80" FontSize="9" SelectionChanged="Template_SelectionChanged"/>
                                    <Grid Margin="0,4,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Button Content="+ Add Selected" Click="AddTemplate_Click" Height="22" FontSize="9"/>
                                        <Button Grid.Column="1" Content="âœ•" Click="DeleteTemplate_Click" Width="22" Height="22" FontSize="9" Margin="4,0,0,0" ToolTip="Delete selected template"/>
                                    </Grid>
                                </StackPanel>
                            </Expander>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <GridSplitter Grid.Column="1" Width="5" 
                          HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                          Background="#888888" 
                          ResizeBehavior="PreviousAndNext" 
                          ResizeDirection="Columns" 
                          ShowsPreview="True"
                          Focusable="False">
                <GridSplitter.Template>
                    <ControlTemplate TargetType="GridSplitter">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="#666666" BorderThickness="1,0" 
                                Cursor="SizeWE"/>
                    </ControlTemplate>
                </GridSplitter.Template>
            </GridSplitter>
            
            <!-- Canvas -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <Canvas x:Name="HorizontalRuler" Grid.Row="0" Grid.Column="1" Height="20" Background="#F8F9FA" ClipToBounds="True"/>
                <Canvas x:Name="VerticalRuler" Grid.Row="1" Grid.Column="0" Width="20" Background="#F8F9FA" ClipToBounds="True"/>
                
                <Border Grid.Row="1" Grid.Column="1" Background="#FFFFFF" BorderBrush="{StaticResource Border}" BorderThickness="0.5" ClipToBounds="True">
                    <Grid>
                        <ScrollViewer x:Name="CanvasScroller" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" PreviewMouseWheel="Canvas_PreviewMouseWheel">
                            <Canvas x:Name="EditorCanvas" Width="2000" Height="1500" Background="White" AllowDrop="True"
                                    Drop="EditorCanvas_Drop" DragOver="EditorCanvas_DragOver"
                                    PreviewMouseLeftButtonDown="Canvas_PreviewMouseLeftButtonDown"
                                    MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                                    MouseRightButtonDown="Canvas_MouseRightButtonDown"
                                    MouseMove="Canvas_MouseMove" MouseLeftButtonUp="Canvas_MouseLeftButtonUp" ClipToBounds="True">
                                <Canvas.LayoutTransform><ScaleTransform x:Name="CanvasScale" ScaleX="1" ScaleY="1"/></Canvas.LayoutTransform>
                                <Canvas.ContextMenu><ContextMenu x:Name="CanvasContextMenu"/></Canvas.ContextMenu>
                            </Canvas>
                        </ScrollViewer>
                        <Border x:Name="MinimapBorder" Visibility="Collapsed" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="10" Width="150" Height="100" Background="#F8F9FA" BorderBrush="{StaticResource Border}" BorderThickness="1" CornerRadius="4" Opacity="0.9">
                            <Grid><Canvas x:Name="MinimapCanvas" ClipToBounds="True"/><Rectangle x:Name="MinimapViewport" Stroke="{StaticResource Accent}" StrokeThickness="2" Fill="#4A90D920" HorizontalAlignment="Left" VerticalAlignment="Top"/></Grid>
                        </Border>
                        <Canvas x:Name="GuideCanvas" IsHitTestVisible="False"/>
                    </Grid>
                </Border>
            </Grid>
            
            <GridSplitter Grid.Column="3" Width="5" 
                          HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                          Background="#888888" 
                          ResizeBehavior="PreviousAndNext" 
                          ResizeDirection="Columns" 
                          ShowsPreview="True"
                          Focusable="False">
                <GridSplitter.Template>
                    <ControlTemplate TargetType="GridSplitter">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="#666666" BorderThickness="1,0" 
                                Cursor="SizeWE"/>
                    </ControlTemplate>
                </GridSplitter.Template>
            </GridSplitter>
            
            <!-- Right Panel -->
            <Border Grid.Column="4" Background="{StaticResource PanelBg}" BorderBrush="{StaticResource Border}" BorderThickness="0.5,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" Background="{StaticResource HeaderBg}" BorderBrush="{StaticResource Border}" BorderThickness="0,0,0,1">
                        <StackPanel Orientation="Horizontal" Margin="6,4">
                            <TextBlock Text="Explorer" FontWeight="SemiBold" FontSize="11"/>
                            <TextBlock x:Name="NodeCountLabel" Text=" (0 nodes)" FontSize="10" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TreeView x:Name="TopologyTree" FontSize="10" BorderThickness="0" SelectedItemChanged="TopologyTree_SelectedItemChanged"/>
                        
                        <Expander Grid.Row="1" Header="Validation" x:Name="ValidationExpander" IsExpanded="False" Margin="4">
                            <Grid Height="120">
                                <ListBox x:Name="ValidationList" FontSize="9" BorderThickness="0" SelectionChanged="ValidationList_Changed"/>
                            </Grid>
                        </Expander>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="White" BorderBrush="#DEE2E6" BorderThickness="0,1,0,0">
            <StatusBarItem><TextBlock x:Name="StatusText" Text="Ready" FontSize="11"/></StatusBarItem>
            <Separator/>
            <StatusBarItem><TextBlock x:Name="FileText" Text="" FontSize="10"/></StatusBarItem>
            <Separator/>
            <StatusBarItem><TextBlock x:Name="NodeCountText" Text="Nodes: 0  Paths: 0  Walls: 0" FontSize="10"/></StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Wall:" FontSize="10" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <ComboBox x:Name="WallTypeCombo" Width="70" Height="20" FontSize="9">
                        <ComboBoxItem Content="Solid" IsSelected="True"/>
                        <ComboBoxItem Content="Glass"/>
                        <ComboBoxItem Content="Partition"/>
                        <ComboBoxItem Content="Fence"/>
                    </ComboBox>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Units:" FontSize="10" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <ComboBox x:Name="UnitsCombo" Width="50" Height="20" FontSize="9">
                        <ComboBoxItem Content="m" IsSelected="True"/>
                        <ComboBoxItem Content="ft"/>
                        <ComboBoxItem Content="px"/>
                    </ComboBox>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Grid:" FontSize="10" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <ComboBox x:Name="GridSizeCombo" Width="50" Height="20" FontSize="9" SelectionChanged="GridSize_Changed">
                        <ComboBoxItem Content="10" Tag="10"/>
                        <ComboBoxItem Content="20" Tag="20" IsSelected="True"/>
                        <ComboBoxItem Content="50" Tag="50"/>
                        <ComboBoxItem Content="100" Tag="100"/>
                    </ComboBox>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="ZoomText" Text="100%" FontSize="10" Margin="0,0,12,0"/>
                    <TextBlock x:Name="MousePosText" Text="X: 0  Y: 0" FontSize="10"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
